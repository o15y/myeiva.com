(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{267:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var o=n(100);var r=n(119);function c(t){return function(t){if(Array.isArray(t))return Object(o.a)(t)}(t)||function(t){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(t))return Array.from(t)}(t)||Object(r.a)(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},270:function(t,e){t.exports=function(data,t,e,n){var o=new Blob(void 0!==n?[n,data]:[data],{type:e||"application/octet-stream"});if(void 0!==window.navigator.msSaveBlob)window.navigator.msSaveBlob(o,t);else{var r=window.URL&&window.URL.createObjectURL?window.URL.createObjectURL(o):window.webkitURL.createObjectURL(o),c=document.createElement("a");c.style.display="none",c.href=r,c.setAttribute("download",t),void 0===c.download&&c.setAttribute("target","_blank"),document.body.appendChild(c),c.click(),setTimeout((function(){document.body.removeChild(c),window.URL.revokeObjectURL(r)}),200)}}},341:function(t,e,n){"use strict";n.r(e);n(19),n(20),n(13),n(40),n(163),n(56),n(67);var o=n(267),r=(n(34),n(7)),c=n(21),d=n(118),l=n(22),m=n(23),v=n(9),f=n(8),h=n(55),y=n(270),w=n.n(y);function _(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,o=Object(v.a)(t);if(e){var r=Object(v.a)(this).constructor;n=Reflect.construct(o,arguments,r)}else n=o.apply(this,arguments);return Object(m.a)(this,n)}}var k=function(t,e,n,desc){var o,r=arguments.length,c=r<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(f.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(o=t[i])&&(c=(r<3?o(c):r>3?o(e,n,c):o(e,n))||c);return r>3&&c&&Object.defineProperty(e,n,c),c},x=function(t){Object(l.a)(k,t);var e,n,m,v,f,h,y=_(k);function k(){var t;return Object(c.a)(this,k),(t=y.apply(this,arguments)).loading=!1,t.loadingSettings=!1,t.loadingSave=!1,t.loadingAdd=!1,t.opened=[],t.team={},t.domains={data:[]},t.ipRestrictions=[],t.newDomain="",t}return Object(d.a)(k,[{key:"created",value:(h=Object(r.a)(regeneratorRuntime.mark((function t(){var e,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.get(),this.loadingSettings=!0,t.prev=2,t.next=5,this.$axios.get("/organizations/".concat(this.$route.params.username));case 5:e=t.sent,data=e.data,this.team=data,t.next=12;break;case 10:t.prev=10,t.t0=t.catch(2);case 12:this.loadingSettings=!1;case 13:case"end":return t.stop()}}),t,this,[[2,10]])}))),function(){return h.apply(this,arguments)})},{key:"get",value:(f=Object(r.a)(regeneratorRuntime.mark((function t(){var e,n,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,this.$axios.get("/organizations/".concat(this.$route.params.username,"/domains?first=10").concat(this.domains.data.length?"&after=".concat(this.domains.data[this.domains.data.length-1].id):""));case 4:n=t.sent,data=n.data,(e=this.domains.data).push.apply(e,Object(o.a)(data.data||[])),this.domains.hasMore=data.hasMore,this.domains=data,t.next=13;break;case 11:t.prev=11,t.t0=t.catch(1);case 13:this.loading=!1;case 14:case"end":return t.stop()}}),t,this,[[1,11]])}))),function(){return f.apply(this,arguments)})},{key:"add",value:(v=Object(r.a)(regeneratorRuntime.mark((function t(){var e,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadingAdd=!0,t.prev=1,t.next=4,this.$axios.put("/organizations/".concat(this.$route.params.username,"/domains"),{domain:this.newDomain});case 4:e=t.sent,data=e.data,this.domains.data.push(data.added),this.newDomain="",t.next=12;break;case 10:t.prev=10,t.t0=t.catch(1);case 12:this.loadingAdd=!1;case 13:case"end":return t.stop()}}),t,this,[[1,10]])}))),function(){return v.apply(this,arguments)})},{key:"save",value:(m=Object(r.a)(regeneratorRuntime.mark((function t(){var e,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loadingSave=!0,t.prev=1,t.next=4,this.$axios.patch("/organizations/".concat(this.$route.params.username),{autoJoinDomain:this.team.autoJoinDomain,onlyAllowDomain:this.team.onlyAllowDomain});case 4:e=t.sent,data=e.data,this.team=data.updated,t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:this.loadingSave=!1;case 12:case"end":return t.stop()}}),t,this,[[1,9]])}))),function(){return m.apply(this,arguments)})},{key:"deleteDomain",value:(n=Object(r.a)(regeneratorRuntime.mark((function t(e,n){var o=this;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:this.$buefy.dialog.confirm({title:"Deleting domain",message:"Are you sure you want to delete your domain <strong>".concat(n,"</strong>? This action is not reversible, and you'll have to verify this domain again if you change your mind."),confirmText:"Yes, delete domain",cancelText:"No, don't delete",type:"is-danger",hasIcon:!0,trapFocus:!0,onConfirm:function(){var t=Object(r.a)(regeneratorRuntime.mark((function t(){return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return o.loading=!0,t.prev=1,t.next=4,o.$axios.delete("/organizations/".concat(o.$route.params.username,"/domains/").concat(e));case 4:t.next=8;break;case 6:t.prev=6,t.t0=t.catch(1);case 8:return o.domains={data:[]},t.abrupt("return",o.get());case 10:case"end":return t.stop()}}),t,null,[[1,6]])})));return function(){return t.apply(this,arguments)}}()});case 1:case"end":return t.stop()}}),t,this)}))),function(t,e){return n.apply(this,arguments)})},{key:"downloadFile",value:function(text){w()(text,"staart-verify.txt")}},{key:"verifyDomain",value:(e=Object(r.a)(regeneratorRuntime.mark((function t(e,n,o){var r,data;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.loading=!0,t.prev=1,t.next=4,this.$axios.post("/organizations/".concat(this.$route.params.username,"/domains/").concat(n,"/verify"),{method:e});case 4:r=t.sent,data=r.data,this.team=data.updated,t.next=11;break;case 9:t.prev=9,t.t0=t.catch(1);case 11:this.loading=!1;case 12:case"end":return t.stop()}}),t,this,[[1,9]])}))),function(t,n,o){return e.apply(this,arguments)})},{key:"addToOpened",value:function(t){this.opened.includes(t)||this.opened.push(t)}},{key:"hasUnverifiedDomain",get:function(){return!!this.domains.data.find((function(i){return!i.isVerified}))}}]),k}(h.b),D=x=k([Object(h.a)({middleware:"authenticated",layout:"teams"})],x),R=n(14),component=Object(R.a)(D,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",[n("h1",{staticClass:"is-size-4"},[t._v("Domains")]),t._v(" "),t.hasUnverifiedDomain?n("b-message",{staticStyle:{"margin-top":"1rem"},attrs:{type:"is-warning","has-icon":""}},[t._v("\n    You have one or more unverified domains in your team. The domain settings\n    will not be actived until you verify the domain.\n  ")]):t._e(),t._v(" "),n("b-table",{attrs:{loading:t.loading,data:t.domains.data,"default-sort-direction":"asc","detail-key":"id","opened-detailed":t.opened,detailed:"","sort-icon":"arrow-up","sort-icon-size":"is-small"},scopedSlots:t._u([{key:"default",fn:function(e){return[n("b-table-column",{attrs:{sortable:"",field:"domain",label:"Domain"}},[t._v("\n        "+t._s(e.row.domain)+"\n        "),e.row.isVerified?n("b-tooltip",{attrs:{label:"Verified"}},[n("b-icon",{attrs:{icon:"check-circle",type:"is-success"}})],1):n("b-tooltip",{attrs:{label:"Unverified"}},[n("b-icon",{attrs:{icon:"alert",type:"is-warning"}})],1)],1),t._v(" "),n("b-table-column",{attrs:{sortable:"",field:"createdAt",label:"Added"}},[t._v("\n        "+t._s(new Date(e.row.createdAt).toLocaleDateString())+"\n      ")]),t._v(" "),n("b-table-column",{staticClass:"has-text-right"},[n("b-button",{attrs:{type:"is-primary"},on:{click:function(n){return t.addToOpened(e.row.id)}}},[t._v("\n          Verify domain\n        ")]),t._v(" "),n("b-tooltip",{attrs:{label:"Delete"}},[n("b-button",{attrs:{type:"is-danger","icon-right":"delete"},on:{click:function(n){return t.deleteDomain(e.row.id,e.row.domain)}}})],1)],1)]}},{key:"detail",fn:function(e){return[e.row.isVerified?n("div",[n("p",[n("b-icon",{staticStyle:{"margin-right":"0.5rem"},attrs:{type:"is-success",icon:"check-circle",size:"is-small"}}),t._v("This domain is successfully verified.\n        ")],1)]):n("div",[n("p",[t._v("\n          To verify your domain, you can either set a DNS TXT record or update\n          a text file.\n        ")]),t._v(" "),n("h3",{staticClass:"is-size-5",staticStyle:{"margin-top":"1rem"}},[t._v("\n          DNS TXT record (recommended)\n        ")]),t._v(" "),n("p",{staticStyle:{"margin-bottom":"1rem"}},[t._v("\n          Add a new DNS record with the following values:\n        ")]),t._v(" "),n("table",{staticClass:"table",staticStyle:{"margin-bottom":"1rem"}},[n("thead",[n("tr",[n("td",[t._v("Type")]),t._v(" "),n("td",[t._v("Name")]),t._v(" "),n("td",[t._v("Content")])])]),t._v(" "),n("tbody",[n("tr",[n("td",[n("code",[t._v("TXT")])]),t._v(" "),n("td",[n("code",[t._v(t._s(e.row.domain))])]),t._v(" "),n("td",[n("code",[t._v(t._s(e.row.verificationCode))])])])])]),t._v(" "),n("b-button",{attrs:{type:"is-primary"},on:{click:function(n){return t.verifyDomain("dns",e.row.id)}}},[t._v("\n          Verify DNS record\n        ")]),t._v(" "),n("h3",{staticClass:"is-size-5",staticStyle:{"margin-top":"1rem"}},[t._v("\n          File upload\n        ")]),t._v(" "),n("p",{staticStyle:{"margin-bottom":"0.5rem"}},[t._v("\n          Alternately, upload a file to your domain:\n          "),n("code",[t._v("/.well-known/staart-verify.txt")]),t._v(". Once completed, this\n          URL should have the contents\n          "),n("code",[t._v(t._s(e.row.verificationCode))]),t._v(":\n          "),n("a",{attrs:{href:"http://"+e.row.domain+"/.well-known/staart-verify.txt",target:"_blank"}},[t._v("\n            http://"+t._s(e.row.domain)+"/.well-known/staart-verify.txt\n          ")])]),t._v(" "),n("b-button",{attrs:{"icon-left":"cloud-download"},on:{click:function(n){return t.downloadFile(e.row.verificationCode)}}},[t._v("\n          Download file\n        ")]),t._v(" "),n("b-button",{attrs:{type:"is-primary"},on:{click:function(n){return t.verifyDomain("file",e.row.id)}}},[t._v("\n          Verify uploaded file\n        ")])],1)]}}])}),t._v(" "),n("div",{staticClass:"has-text-centered"},[t.domains.hasMore?n("b-button",{attrs:{"icon-right":"arrow-down",loading:t.loading},on:{click:t.get}},[t._v("\n      Load more domains\n    ")]):t._e()],1),t._v(" "),n("h2",{staticClass:"is-size-5",staticStyle:{"margin-top":"1rem"}},[t._v("Add domain")]),t._v(" "),n("form",{staticStyle:{margin:"0.5rem 0 1.5rem"},on:{submit:function(e){return e.preventDefault(),t.add(e)}}},[n("b-field",{attrs:{label:"Domain"}},[n("b-input",{attrs:{type:"text",required:""},model:{value:t.newDomain,callback:function(e){t.newDomain=e},expression:"newDomain"}})],1),t._v(" "),n("b-button",{attrs:{type:"is-primary","native-type":"submit",loading:t.loadingAdd}},[t._v("\n      Add domain\n    ")])],1),t._v(" "),n("form",{staticStyle:{"margin-top":"1rem"},on:{submit:function(e){return e.preventDefault(),t.save(e)}}},[n("h1",{staticClass:"is-size-5",staticStyle:{margin:"1rem 0"}},[t._v("Domain settings")]),t._v(" "),n("b-field",[n("b-checkbox",{model:{value:t.team.onlyAllowDomain,callback:function(e){t.$set(t.team,"onlyAllowDomain",e)},expression:"team.onlyAllowDomain"}},[t._v("\n        Managers can only invite users with emails on our domains to join this\n        team\n      ")])],1),t._v(" "),n("b-field",[n("b-checkbox",{model:{value:t.team.autoJoinDomain,callback:function(e){t.$set(t.team,"autoJoinDomain",e)},expression:"team.autoJoinDomain"}},[t._v("\n        Users with verified emails on our domains can automatically join this\n        team\n      ")])],1),t._v(" "),n("div",{staticStyle:{"margin-top":"1rem"}},[n("b-button",{attrs:{type:"is-primary","native-type":"submit",loading:t.loadingSave}},[t._v("\n        Update domain settings\n      ")])],1),t._v(" "),n("b-loading",{attrs:{"is-full-page":!1,active:t.loadingSettings},on:{"update:active":function(e){t.loadingSettings=e}}})],1)],1)}),[],!1,null,null,null);e.default=component.exports}}]);