(window.webpackJsonp=window.webpackJsonp||[]).push([[4],{267:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(100);var o=n(119);function c(e){return function(e){if(Array.isArray(e))return Object(r.a)(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||Object(o.a)(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}},309:function(e,t,n){"use strict";n.r(t);n(19),n(20),n(13),n(40),n(56),n(67);var r=n(267),o=(n(34),n(7)),c=n(21),l=n(118),d=n(22),m=n(23),f=n(9),v=n(8),h=n(55);function y(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=Object(f.a)(e);if(t){var o=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(m.a)(this,n)}}var x=function(e,t,n,desc){var r,o=arguments.length,c=o<3?t:null===desc?desc=Object.getOwnPropertyDescriptor(t,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(v.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(e,t,n,desc);else for(var i=e.length-1;i>=0;i--)(r=e[i])&&(c=(o<3?r(c):o>3?r(t,n,c):r(t,n))||c);return o>3&&c&&Object.defineProperty(t,n,c),c},_=function(e){Object(d.a)(_,e);var t,n,m,f,v,h,x=y(_);function _(){var e;return Object(c.a)(this,_),(e=x.apply(this,arguments)).loading=!1,e.loadingSave=!1,e.loadingAdd=!1,e.loadingTeams=!1,e.expires=!1,e.hasCode=!1,e.opened=[],e.teams={data:[]},e.coupons={data:[]},e.amount="100",e.code="",e.maxUses="",e.teamRestrictions=null,e.currency="usd",e.expiresAt=new Date,e.jwt=!1,e.description="",e.currencies={usd:"$",eur:"€",inr:"₹"},e}return Object(l.a)(_,[{key:"mounted",value:(h=Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.getTeams(),e.abrupt("return",this.get());case 2:case"end":return e.stop()}}),e,this)}))),function(){return h.apply(this,arguments)})},{key:"get",value:(v=Object(o.a)(regeneratorRuntime.mark((function e(){var t,n,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loading=!0,e.prev=1,e.next=4,this.$axios.get("/admin/coupons?first=10".concat(this.coupons.data.length?"&after=".concat(this.coupons.data[this.coupons.data.length-1].id):""));case 4:n=e.sent,data=n.data,(t=this.coupons.data).push.apply(t,Object(r.a)(data.data||[])),this.coupons.hasMore=data.hasMore,this.coupons=data,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(1);case 13:this.loading=!1;case 14:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(){return v.apply(this,arguments)})},{key:"getTeams",value:(f=Object(o.a)(regeneratorRuntime.mark((function e(){var t,n,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingTeams=!0,e.prev=1,e.next=4,this.$axios.get("/admin/organizations?first=100".concat(this.teams.data.length?"&after=".concat(this.teams.data[this.teams.data.length-1].id):""));case 4:n=e.sent,data=n.data,(t=this.teams.data).push.apply(t,Object(r.a)(data.data||[])),this.teams.hasMore=data.hasMore,this.teams=data,e.next=13;break;case 11:e.prev=11,e.t0=e.catch(1);case 13:this.loadingTeams=!1;case 14:case"end":return e.stop()}}),e,this,[[1,11]])}))),function(){return f.apply(this,arguments)})},{key:"add",value:(m=Object(o.a)(regeneratorRuntime.mark((function e(){var t,data;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingAdd=!0,e.prev=1,e.next=4,this.$axios.put("/admin/coupons",{amount:parseInt(this.amount),maxUses:this.maxUses?parseInt(this.maxUses):void 0,teamRestrictions:this.teamRestrictions?String(this.teamRestrictions):void 0,code:this.code||void 0,currency:this.currency,jwt:this.jwt,expiresAt:this.expires?this.expiresAt:void 0,description:this.description||void 0});case 4:t=e.sent,"string"==typeof(data=t.data).added?alert(data.added):this.coupons.data.push(data.added),this.code="",this.amount="100",this.maxUses="",this.teamRestrictions=null,this.currency="usd",this.jwt=!1,this.expires=!1,this.hasCode=!1,this.description="",this.expiresAt=new Date,e.next=21;break;case 19:e.prev=19,e.t0=e.catch(1);case 21:this.loadingAdd=!1;case 22:case"end":return e.stop()}}),e,this,[[1,19]])}))),function(){return m.apply(this,arguments)})},{key:"deleteCoupon",value:(n=Object(o.a)(regeneratorRuntime.mark((function e(t,code){var n=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.$buefy.dialog.confirm({title:"Deleting coupon",message:"Are you sure you want to delete the coupon with code <code>".concat(code,"</code>? This action is not reversible, and this coupon will stop working immediately."),confirmText:"Yes, delete coupon",cancelText:"No, don't delete",type:"is-danger",hasIcon:!0,trapFocus:!0,onConfirm:function(){var e=Object(o.a)(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n.loading=!0,e.prev=1,e.next=4,n.$axios.delete("/admin/coupons/".concat(t));case 4:e.next=8;break;case 6:e.prev=6,e.t0=e.catch(1);case 8:return n.coupons={data:[]},e.abrupt("return",n.get());case 10:case"end":return e.stop()}}),e,null,[[1,6]])})));return function(){return e.apply(this,arguments)}}()});case 1:case"end":return e.stop()}}),e,this)}))),function(e,t){return n.apply(this,arguments)})},{key:"save",value:(t=Object(o.a)(regeneratorRuntime.mark((function e(data){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.loadingSave=!0,e.prev=1,e.next=4,this.$axios.patch("/admin/coupons/".concat(data.id),{currency:data.currency,amount:data.amount?parseInt(data.amount):void 0,code:data.code,description:data.description,maxUses:data.maxUses?parseInt(data.maxUses):void 0,teamRestrictions:data.teamRestrictions});case 4:this.removeFromOpened(data.id),e.next=9;break;case 7:e.prev=7,e.t0=e.catch(1);case 9:return this.loadingSave=!1,this.coupons={data:[]},e.abrupt("return",this.get());case 12:case"end":return e.stop()}}),e,this,[[1,7]])}))),function(e){return t.apply(this,arguments)})},{key:"addToOpened",value:function(e){this.opened.includes(e)||this.opened.push(e)}},{key:"removeFromOpened",value:function(e){this.opened=this.opened.filter((function(i){return i!==e}))}},{key:"updateValue",value:function(e,t,n){this.coupons.data=this.coupons.data.map((function(i){return i.id===e&&(i[t]=n),i}))}}]),_}(h.b),w=_=x([Object(h.a)({middleware:"authenticated",layout:"admin"})],_),k=n(14),component=Object(k.a)(w,(function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",[n("h1",{staticClass:"is-size-4"},[e._v("Coupon codes")]),e._v(" "),n("b-table",{attrs:{loading:e.loading,data:e.coupons.data,"opened-detailed":e.opened,detailed:"","detail-key":"id","default-sort-direction":"asc","sort-icon":"arrow-up","sort-icon-size":"is-small"},scopedSlots:e._u([{key:"default",fn:function(t){return[n("b-table-column",{attrs:{sortable:"",field:"code",label:"Coupon code"}},[n("code",[e._v(e._s(t.row.code))]),e._v(" "),t.row.maxUses===t.row.usedCount?n("b-tooltip",{attrs:{label:"Used"}},[n("b-icon",{attrs:{icon:"credit-card-off",type:"is-danger"}})],1):e._e()],1),e._v(" "),n("b-table-column",{attrs:{label:"Amount"}},[e._v("\n        "+e._s(e.currencies[t.row.currency]||t.row.currency)+e._s(t.row.amount/100)+"\n      ")]),e._v(" "),n("b-table-column",{attrs:{sortable:"",field:"expiresAt",label:"Expires"}},[t.row.expiresAt?n("span",[e._v("\n          "+e._s(new Date(t.row.expiresAt).toLocaleDateString())+"\n        ")]):n("span",[n("em",[e._v("Never")])])]),e._v(" "),n("b-table-column",{staticClass:"has-text-right"},[n("b-tooltip",{attrs:{label:"Edit"}},[n("b-button",{attrs:{type:"is-primary","icon-right":"pencil"},on:{click:function(n){return e.addToOpened(t.row.id)}}})],1),e._v(" "),n("b-tooltip",{attrs:{label:"Delete"}},[n("b-button",{attrs:{type:"is-danger","icon-right":"delete"},on:{click:function(n){return e.deleteCoupon(t.row.id,t.row.code)}}})],1)],1)]}},{key:"detail",fn:function(t){return[n("form",{on:{submit:function(n){return n.preventDefault(),e.save(t.row)}}},[n("b-field",{attrs:{label:"Currency"}},[n("div",{staticClass:"field"},e._l(e.currencies,(function(symbol,r){return n("b-radio",{key:"c"+r,attrs:{name:"name","native-value":r},on:{input:function(n){return e.updateValue(t.row.id,"currency",n)}}},[e._v("\n              "+e._s(r.toUpperCase())+"\n            ")])})),1)]),e._v(" "),n("b-field",{attrs:{label:"Amount"}},[n("b-input",{attrs:{type:"number",value:t.row.amount},on:{input:function(n){return e.updateValue(t.row.id,"amount",n)}}})],1),e._v(" "),n("b-field",{attrs:{label:"Coupon code"}},[n("b-input",{attrs:{type:"text",value:t.row.code},on:{input:function(n){return e.updateValue(t.row.id,"code",n)}}})],1),e._v(" "),n("b-field",{attrs:{label:"Description"}},[n("b-input",{attrs:{type:"text",value:t.row.description},on:{input:function(n){return e.updateValue(t.row.id,"description",n)}}})],1),e._v(" "),n("b-field",{attrs:{label:"Max uses"}},[n("b-input",{attrs:{type:"number",value:t.row.maxUses},on:{input:function(n){return e.updateValue(t.row.id,"maxUses",n)}}})],1),e._v(" "),n("b-field",{attrs:{label:"Team restriction"}},[n("b-select",{attrs:{value:t.row.teamRestrictions,loading:e.loadingTeams,expanded:""},on:{input:function(n){return e.updateValue(t.row.id,"teamRestrictions",n)}}},[n("option",{domProps:{value:null}},[e._v("All teams can use")]),e._v(" "),e._l(e.teams.data,(function(t){return n("option",{key:"t"+t.id,domProps:{value:t.id}},[e._v("\n              "+e._s(t.name)+"\n            ")])}))],2)],1),e._v(" "),n("b-button",{attrs:{type:"is-primary","native-type":"submit",loading:e.loadingSave}},[e._v("\n          Update coupon\n        ")]),e._v(" "),n("b-button",{on:{click:function(n){return n.preventDefault(),e.removeFromOpened(t.row.id)}}},[e._v("\n          Cancel\n        ")])],1)]}}])}),e._v(" "),n("div",{staticClass:"has-text-centered"},[e.coupons.hasMore?n("b-button",{attrs:{"icon-right":"arrow-down",loading:e.loading},on:{click:e.get}},[e._v("\n      Load more coupons\n    ")]):e._e()],1),e._v(" "),n("h2",{staticClass:"is-size-5",staticStyle:{"margin-top":"1rem"}},[e._v("Add coupon")]),e._v(" "),n("p",{staticStyle:{"margin-top":"0.5rem"}},[e._v("\n    Generate a new coupon code to share with teams. Make sure the amount is in\n    basic monetary units like cents or paise (multiply by 100).\n  ")]),e._v(" "),n("form",{staticStyle:{margin:"0.5rem 0 1.5rem"},on:{submit:function(t){return t.preventDefault(),e.add(t)}}},[n("div",{staticClass:"columns"},[n("b-field",{staticClass:"column",staticStyle:{"margin-bottom":"0","padding-bottom":"0"},attrs:{label:"Currency"}},[n("div",{staticClass:"field"},e._l(e.currencies,(function(symbol,t){return n("b-radio",{key:"c"+t,attrs:{name:"name","native-value":t},model:{value:e.currency,callback:function(t){e.currency=t},expression:"currency"}},[e._v("\n            "+e._s(t.toUpperCase())+"\n          ")])})),1)]),e._v(" "),n("b-field",{staticClass:"column",staticStyle:{"margin-bottom":"0","padding-bottom":"0"},attrs:{label:"Amount"}},[n("b-input",{attrs:{type:"number",required:""},model:{value:e.amount,callback:function(t){e.amount=t},expression:"amount"}})],1)],1),e._v(" "),n("div",{staticClass:"columns"},[n("b-field",{staticClass:"column",staticStyle:{"margin-bottom":"0","padding-bottom":"0"},attrs:{label:"Team restriction"}},[n("b-select",{attrs:{loading:e.loadingTeams,expanded:""},model:{value:e.teamRestrictions,callback:function(t){e.teamRestrictions=t},expression:"teamRestrictions"}},[n("option",{domProps:{value:null}},[e._v("All teams can use")]),e._v(" "),e._l(e.teams.data,(function(t){return n("option",{key:"t"+t.id,domProps:{value:t.id}},[e._v("\n            "+e._s(t.name)+"\n          ")])}))],2)],1),e._v(" "),n("b-field",{staticClass:"column",staticStyle:{"margin-bottom":"0","padding-bottom":"0"},attrs:{label:"Max uses"}},[n("b-input",{attrs:{type:"number"},model:{value:e.maxUses,callback:function(t){e.maxUses=t},expression:"maxUses"}})],1)],1),e._v(" "),n("b-field",[n("b-checkbox",{model:{value:e.jwt,callback:function(t){e.jwt=t},expression:"jwt"}},[e._v("\n        Create JWT coupon code\n      ")])],1),e._v(" "),n("b-field",[n("b-checkbox",{model:{value:e.expires,callback:function(t){e.expires=t},expression:"expires"}},[e._v("\n        Add coupon expiry time\n      ")])],1),e._v(" "),e.expires?n("b-field",{attrs:{label:"Expiry"}},[n("b-datepicker",{attrs:{placeholder:"Click to select...",icon:"calendar-today","trap-focus":""},model:{value:e.expiresAt,callback:function(t){e.expiresAt=t},expression:"expiresAt"}})],1):e._e(),e._v(" "),n("b-field",[n("b-checkbox",{model:{value:e.hasCode,callback:function(t){e.hasCode=t},expression:"hasCode"}},[e._v("\n        Add coupon code\n      ")])],1),e._v(" "),e.hasCode?n("b-field",{attrs:{label:"Coupon code"}},[n("b-input",{attrs:{type:"text"},model:{value:e.code,callback:function(t){e.code=t},expression:"code"}})],1):e._e(),e._v(" "),n("b-button",{attrs:{type:"is-primary","native-type":"submit",loading:e.loadingAdd}},[e._v("\n      Add coupon for "+e._s(e.currencies[e.currency]||e.currency)+e._s(e.amount/100)+"\n    ")])],1)],1)}),[],!1,null,null,null);t.default=component.exports}}]);